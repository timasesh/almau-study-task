{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль студента</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600&family=Raleway:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'student_styles.css' %}">
</head>
<body>
<header class="student-header">
    <div class="container header-content">
        <div class="profile-header-left"></div>
        <div class="header-btns ml-auto">
            <a href="{% url 'student_page' %}" class="btn btn-profile"><i class="fas fa-arrow-left mr-1"></i>Назад</a>
            <a href="{% url 'logout' %}" class="btn btn-logout"><i class="fas fa-sign-out-alt mr-1"></i>Выйти</a>
        </div>
    </div>
</header>
<main>
    <div class="profile-card profile-modern mt-5 mb-5">
        <div class="profile-avatar-block mb-4">
            <div class="student-avatar-container mx-auto mb-3">
                {% if student.avatar %}
                    <img src="{{ student.avatar.url }}" alt="Avatar" class="student-avatar">
                {% else %}
                    <img src="https://cdn.jsdelivr.net/gh/edent/SuperTinyIcons/images/svg/user.svg" alt="Avatar" class="student-avatar" style="background:#e3f2fd; padding:7px;">
                {% endif %}
            </div>
            <div class="student-name-block mb-2">
                <span class="student-name profile-name">{{ student.get_full_name|default:student.user.username }}</span>
            </div>
        </div>
        <div class="profile-info-modern mb-5">
            <div class="profile-info-modern-box"><i class="fas fa-user mr-2"></i><span>Username:</span> <b>{{ student.user.username }}</b></div>
            <div class="profile-info-modern-box"><i class="fas fa-envelope mr-2"></i><span>Email:</span> <b>{{ student.email }}</b></div>
            <div class="profile-info-modern-box"><i class="fas fa-phone mr-2"></i><span>Телефон:</span> <b>{{ student.phone_number|default:'-' }}</b></div>
            <div class="profile-info-modern-box"><i class="fas fa-id-card mr-2"></i><span>Имя:</span> <b>{{ student.first_name|default:'-' }}</b></div>
            <div class="profile-info-modern-box"><i class="fas fa-id-card mr-2"></i><span>Фамилия:</span> <b>{{ student.last_name|default:'-' }}</b></div>
        </div>
        <div class="profile-stats-modern mb-4">
            <div class="stat-card stat-header">
                <div class="stat-icon"><i class="fas fa-star text-star"></i></div>
                <div class="stat-value text-star">{{ student.stars }}</div>
                <div class="stat-label">Звёзд</div>
            </div>
            <div class="stat-card stat-header">
                <div class="stat-icon"><i class="fas fa-book"></i></div>
                <div class="stat-value">{{ student.courses.count }}</div>
                <div class="stat-label">Курсов</div>
            </div>
            <div class="stat-card stat-header">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-value">{{ student.groups.count }}</div>
                <div class="stat-label">Групп</div>
            </div>
        </div>
        {% if not student.profile_edited_once %}
            <button id="edit-button" class="btn btn-profile mt-4"><i class="fas fa-edit mr-1"></i>Редактировать</button>
            <form id="profile-edit" class="hidden mt-3" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group text-left">
                    <label for="avatar">Аватар</label>
                    <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*" value="{{ form.avatar.value }}">
                </div>
                <div class="form-group text-left">
                    <label for="phone_number">Номер телефона</label>
                    <input type="text" class="form-control" id="phone_number" name="phone_number" value="{{ form.phone_number.value }}">
                </div>
                <div class="form-group text-left">
                    <label for="email">Электронная почта</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ form.email.value }}">
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <button type="submit" class="btn btn-profile btn-block">Сохранить изменения</button>
                    <button type="button" id="cancel-button" class="btn btn-secondary btn-block">Отмена</button>
                </div>
            </form>
        {% else %}
            {% if active_request %}
                <div class="alert alert-info mt-3">Запрос на редактирование отправлен. Ожидайте ответа администратора.</div>
            {% elif admin_status == 'approved' %}
                <div class="alert alert-success mt-3">Ваш запрос на редактирование подтверждён. <br>{{ admin_response }}</div>
            {% elif admin_status == 'rejected' %}
                <div class="alert alert-danger mt-3">Ваш запрос на редактирование отклонён. <br>{{ admin_response }}</div>
            {% else %}
                <form method="post" class="mt-3">
                    {% csrf_token %}
                    <button type="submit" name="request_edit" class="btn btn-profile">Запросить редактирование аккаунта</button>
                </form>
            {% endif %}
        {% endif %}
    </div>
</main>
<script>
    const editButton = document.getElementById('edit-button');
    const profileEdit = document.getElementById('profile-edit');
    const cancelButton = document.getElementById('cancel-button');
    if (editButton && profileEdit) {
        editButton.addEventListener('click', () => {
            editButton.classList.add('hidden');
            profileEdit.classList.remove('hidden');
        });
    }
    if (cancelButton && profileEdit) {
        cancelButton.addEventListener('click', () => {
            editButton.classList.remove('hidden');
            profileEdit.classList.add('hidden');
        });
    }
</script>
</body>
</html>